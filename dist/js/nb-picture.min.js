/*
 * nb-picture
 * https://github.com/netbek/nb-picture
 *
 * @author Hein Bekker <hein@netbek.co.za>
 * @copyright (c) 2015 Hein Bekker
 * @license http://www.gnu.org/licenses/agpl-3.0.txt AGPLv3
 */
!function(a,b){"use strict";b.module("nb.picture",["nb.i18n","nb.lodash","nb.picture.templates"]).constant("PICTURE_POSITION",{LEFT_TOP:"left top",LEFT_BOTTOM:"left bottom",RIGHT_TOP:"right top",RIGHT_BOTTOM:"right bottom"}).constant("PICTURE_SHAPE",{CIRCLE:"circle",POLYGON:"poly",RECTANGLE:"rect"})}(window,window.angular),function(a,b){"use strict";b.module("nb.picture").filter("join",function(){return function(a,c){return b.isArray(a)?a.join(b.isDefined(c)?c:","):""}})}(window,window.angular),function(a,b){"use strict";function c(){var a={mediaqueries:{small:"only screen and (min-width: 0px)",medium:"only screen and (min-width: 640px)",large:"only screen and (min-width: 992px)",xlarge:"only screen and (min-width: 1440px)",xxlarge:"only screen and (min-width: 1920px)",landscape:"only screen and (orientation: landscape)",portrait:"only screen and (orientation: portrait)",retina:"only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (min--moz-device-pixel-ratio: 2), only screen and (-o-min-device-pixel-ratio: 2/1), only screen and (min-device-pixel-ratio: 2), only screen and (min-resolution: 192dpi), only screen and (min-resolution: 2dppx)"}};return{set:function(b){a=b},$get:function(){return a}}}b.module("nb.picture").provider("nbPictureConfig",c)}(window,window.angular),function(a,b,c){"use strict";function d(a,b,d,f,g){var h=this,i={},j={$show:!1,name:c,areas:[],resize:!1,relCoords:!1,overlays:{}},k={$id:c,$coords:[],shape:c,coords:[],href:"#",alt:"",title:"",data:c},l={$areas:[],alwaysOn:!1,click:!1,focus:!1,hover:!1,single:!1},m={};this.initPicture=function(){var a="nb-picture-"+ ++e;return m[a]={$id:a},a},this.destroyPicture=function(a){m=d.omit(m,a)},this.getPicture=function(a){return m[a]},this.setPicture=function(a,b){if(!d.isArray(b.sources))throw new Error(f.t('Excepted attribute "!attribute" to evaluate to !type',{"!attribute":"sources","!type":"Array"}));d.isUndefined(b.alt)&&(b.alt="");for(var c=[],e=b.sources.length,i=e-1;i>=0;i--){var j,k=b.sources[i];!d.isUndefined(k[1])&&k[1]in g.mediaqueries&&(j=g.mediaqueries[k[1]]),c.push({srcset:k[0],media:j})}c.push({srcset:b.defaultSource});var l=h.getMap(a);m[a].sources=c,m[a].img={srcset:b.defaultSource,alt:b.alt,usemap:l&&!l.resize&&l.name?"#"+l.name:""}},this.getMap=function(a){var b=m[a];return b?b.map:void 0},this.setMap=function(a,b){if(!d.isObject(b.map))throw new Error(f.t('Excepted attribute "!attribute" to evaluate to !type',{"!attribute":"map","!type":"Object"}));var c=h.getPicture(a);if(c){var g=d.extend({},j,b.map);g.name=g.name||"nb-picture-map-"+ ++e,d.forEach(g.areas,function(a,b){g.areas[b]=d.extend({},k,a,{$id:"nb-picture-map-area-"+ ++e,$coords:a.coords})});var m={};d.forEach(g.overlays,function(a,b){a=d.extend({},l,a),i.touch&&(a.click=!0,a.focus=!1,a.hover=!1),(a.alwaysOn||a.click||a.focus||a.hover)&&(a.$id=b,m[b]=a)}),g.overlays=m,c.map=g}},this.resizeMap=function(a,c,e,f){var g=h.getMap(a);g&&g.relCoords&&c&&e&&d.forEach(g.areas,function(a,d){var h,i,j=a.shape,k=a.coords,l=k.length,m=new Array(l);if(j===b.CIRCLE)for(h=0;l>h&&3>h;h++)2>h?(i=k[h]*(h%2===0?c:e),f&&(i=Math.round(i)),m[h]=i):(i=k[h]*Math.min(c,e),f&&(i=Math.round(i)),m[h]=i);else if(j===b.POLYGON)for(h=0;l>h;h++)i=k[h]*(h%2===0?c:e),f&&(i=Math.round(i)),m[h]=i;else if(j===b.RECTANGLE)for(h=0;l>h&&4>h;h++)i=k[h]*(h%2===0?c:e),f&&(i=Math.round(i)),m[h]=i;g.areas[d].$coords=m})},this.getMapAreas=function(a){var b=h.getMap(a);return b?b.areas:void 0},this.getMapArea=function(){},this.setMapArea=function(){},this.deleteMapArea=function(a,b){var c=h.getMap(a);if(c){var e=d.findIndex(c.areas,{$id:b});e>-1&&c.areas.splice(e,1),d.forEach(c.overlays,function(a,e){var f=c.overlays[e].$areas,g=d.findIndex(f,{$id:b});g>-1&&f.splice(g,1)})}},this.getMapOverlay=function(a,b){var c=h.getMap(a);return c?c.overlays[b]:void 0},this.getMapOverlayAreas=function(a,b){var c=h.getMapOverlay(a,b);return c?c.$areas:void 0},this.setMapOverlayAreas=function(a,b,c){var d=h.getMapOverlay(a,b);d&&(d.$areas=c&&c.length?c:[])}}b.module("nb.picture").service("nbPictureService",d);var e=0;d.$inject=["PICTURE_POSITION","PICTURE_SHAPE","_","nbI18N","nbPictureConfig"]}(window,window.angular),function(a,b){"use strict";function c(a,b,c){var d={};return d.getPosition=function(b,c){return.5>b?.5>c?a.LEFT_TOP:a.LEFT_BOTTOM:.5>c?a.RIGHT_TOP:a.RIGHT_BOTTOM},d.contains=function(a,c,e){var f=e[0],g=e[1];if(a===b.CIRCLE){var h=c[0],i=c[1],j=c[2],k=(f-h)*(f-h)+(g-i)*(g-i);return j*j>=k}if(a===b.POLYGON||a===b.RECTANGLE){var l=d.getBounds(a,c);return f>=l[0]&&f<=l[2]&&g>=l[1]&&g<=l[3]}return!1},d.getSize=function(a,b){var c=d.getBounds(a,b);return{width:c[2]-c[0],height:c[3]-c[1]}},d.getBounds=function(a,d){var e=0,f=0,g=0,h=0;if(a===b.CIRCLE)e=d[0]-d[2],f=d[1]-d[2],g=d[0]+d[2],h=d[1]+d[2];else if(a===b.POLYGON||a===b.RECTANGLE){var i=[],j=[];c.forEach(d,function(a,b){b%2===0?i.push(a):j.push(a)}),e=c.min(i),f=c.min(j),g=c.max(i),h=c.max(j)}return[e,f,g,h]},d.getCenter=function(a,c,e){var f=0,g=0;if(a===b.CIRCLE)f=c[0],g=c[1];else if(a===b.POLYGON||a===b.RECTANGLE){var h=d.getBounds(a,c);f=(h[0]+h[2])/2,g=(h[1]+h[3])/2}return e&&(f=Math.round(f),g=Math.round(g)),[f,g]},d}b.module("nb.picture").factory("nbPictureUtils",c),c.$inject=["PICTURE_POSITION","PICTURE_SHAPE","_"]}(window,window.angular),function(a,b){"use strict";function c(a,b,c,d,e,f,g,h,i){function j(a){var b=a.readyState;return!a.src&&!a.srcset||!a.complete&&"complete"!=b&&"loaded"!=b&&4!=b?!1:!0}function k(){(q.src||q.srcset)&&(a.complete=!0,n())}function l(){j(q)&&(a.complete=!0,n())}function m(){p.on("error",k),p.on("load",l),p.on("readystatechange",l)}function n(){p.off("error",k),p.off("load",l),p.off("readystatechange",l)}var o,p,q,r={init:!1},s=[];a.complete=!1,a.width=function(){return a.complete&&q?q.scrollWidth:0},a.height=function(){return a.complete&&q?q.scrollHeight:0},this.attrs=function(){return{defaultSource:c.defaultSource,sources:c.sources,alt:c.alt}},this.init=function(){r.init||(r.init=!0,o=i.initPicture(),p=b.find("img"),q=p[0])},this.destroy=function(){h.forEach(s,function(a){d.cancel(a)}),p&&n(),i.destroyPicture(o)},this.update=function(c){r.init&&(h.forEach(s,function(a){d.cancel(a)}),p&&n(),a.complete=!1,m(),c.sources=a.$eval(c.sources),i.setPicture(o,c),a.picture=i.getPicture(o),s.push(d(function(){g(b)})))}}b.module("nb.picture").controller("nbPictureController",c),c.$inject=["$scope","$element","$attrs","$timeout","nbI18N","nbPictureConfig","picturefill","_","nbPictureService"]}(window,window.angular),function(a,b){"use strict";function c(){return{restrict:"EA",replace:!0,controller:"nbPictureController",templateUrl:"templates/nb-picture.html",link:function(a,b,c,d){d.init();var e=a.$watch(d.attrs,function(a){d.update(a)},!0);a.$on("$destroy",function(){e(),d.destroy()})}}}b.module("nb.picture").directive("nbPicture",c)}(window,window.angular),function(a,b){"use strict";function c(){return{restrict:"EA",replace:!0,controller:"nbPictureController",templateUrl:"templates/nb-picture-once.html",link:function(a,b,c,d){d.init();var e=a.$watch(d.attrs,function(a){d.update(a),e()},!0);a.$on("$destroy",function(){e(),d.destroy()})}}}b.module("nb.picture").directive("nbPictureOnce",c)}(window,window.angular),function(a,b){"use strict";function c(b,c,d,e,f,g,h,i,j){function k(a){var b=a.readyState;return!a.src&&!a.srcset||!a.complete&&"complete"!=b&&"loaded"!=b&&4!=b?!1:!0}function l(){(u.src||u.srcset)&&(b.complete=!0,o(),b.$broadcast("nbPicture:baseError"))}function m(){k(u)&&(b.complete=!0,o(),j.resizeMap(s,b.width(),b.height(),!0),b.$broadcast("nbPicture:baseLoad"),b.$apply())}function n(){t.on("error",l),t.on("load",m),t.on("readystatechange",m)}function o(){t.off("error",l),t.off("load",m),t.off("readystatechange",m)}function p(){j.resizeMap(s,b.width(),b.height(),!0),b.$broadcast("nbPicture:resize"),b.$apply()}function q(){a.addEventListener?a.addEventListener("resize",p,!1):a.attachEvent&&a.attachEvent("onresize",p)}function r(){a.removeEventListener?a.removeEventListener("resize",p,!1):a.detachEvent&&a.detachEvent("onresize",p)}var s,t,u,v={init:!1,touch:!1},w=[];b.complete=!1,b.clickArea=function(c){var d=a.location.href,e=c.target.href;0===e.indexOf(d)&&(e=e.slice(d.length)),"#"===e&&c.preventDefault(),b.$broadcast("nbPicture:clickArea",c)},b.focusArea=function(a,c){b.$broadcast("nbPicture:focusArea",a,c)},b.hoverArea=function(a,c){b.$broadcast("nbPicture:hoverArea",a,c)},b.width=function(){return b.complete&&u?u.scrollWidth:0},b.height=function(){return b.complete&&u?u.scrollHeight:0},this.attrs=function(){return{defaultSource:d.defaultSource,sources:d.sources,alt:d.alt,map:d.map}},this.init=function(){v.init||(v.init=!0,s=j.initPicture(),t=c.find("img"),u=t[0])},this.destroy=function(){i.forEach(w,function(a){e.cancel(a)}),r(),t&&o(),j.destroyPicture(s)},this.update=function(a){v.init&&(i.forEach(w,function(a){e.cancel(a)}),r(),t&&o(),b.complete=!1,n(),a.map=b.$eval(a.map),j.setMap(s,a),a.sources=b.$eval(a.sources),j.setPicture(s,a),b.map=j.getMap(s),b.picture=j.getPicture(s),w.push(e(function(){h(c),q()})))}}b.module("nb.picture").controller("nbPictureMapController",c),c.$inject=["$scope","$element","$attrs","$timeout","nbI18N","nbPictureConfig","picturefill","_","nbPictureService","PICTURE_SHAPE"]}(window,window.angular),function(a,b){"use strict";function c(){return{restrict:"EA",replace:!0,transclude:!0,controller:"nbPictureMapController",templateUrl:"templates/nb-picture-map.html",link:function(a,b,c,d){d.init();var e=a.$watch(d.attrs,function(a){d.update(a)},!0);a.$on("$destroy",function(){e(),d.destroy()})}}}b.module("nb.picture").directive("nbPictureMap",c)}(window,window.angular),function(a,b){"use strict";function c(){return{restrict:"EA",replace:!0,transclude:!0,controller:"nbPictureMapController",templateUrl:"templates/nb-picture-map-once.html",link:function(a,b,c,d){d.init();var e=a.$watch(d.attrs,function(a){d.update(a),e()},!0);a.$on("$destroy",function(){e(),d.destroy()})}}}b.module("nb.picture").directive("nbPictureMapOnce",c)}(window,window.angular),function(a,b){"use strict";function c(){return{restrict:"EA",replace:!0,scope:!0,templateUrl:"templates/nb-picture-map-overlay-areas.html",link:function(a){var c=a.$watch(function(){return{alt:a.picture&a.picture.img?a.picture.img.alt:"",usemap:a.map&&a.map.name?"#"+a.map.name:""}},function(a,c,d){b.forEach(a,function(a,b){d[b]=a})},!0);a.$on("$destroy",function(){c()})}}}b.module("nb.picture").directive("nbPictureMapOverlayAreas",c)}(window,window.angular),function(a,b){"use strict";function c(a){function b(b,c,d,e){var f=!1,g=d;return e.length&&(f=!0,g=[],a.forEach(e,function(b){var e=a.findIndex(d,{$id:b});if(0>e){var f=a.find(c,{$id:b});f&&g.push(a.cloneDeep(f))}})),{dirty:f,newValue:g,oldValue:d}}function c(b,c,d,e){var f=!1,g=d;return e.length&&(f=!0,g=[],a.forEach(e,function(b){var d=a.find(c,{$id:b});d&&g.push(a.cloneDeep(d))})),{dirty:f,newValue:g,oldValue:d}}function d(b,d,e){return c(b,d,e,a.pluck(d,"$id"))}function e(b,c,d,e){var f=!1,g=d;return e.length&&(f=!0,g=[],a.forEach(d,function(b){a.indexOf(e,b.$id)<0&&g.push(b)})),{dirty:f,newValue:g,oldValue:d}}function f(b,c,d){return e(b,c,d,a.pluck(d,"$id"))}var g={};return g.onBaseLoad=function(a,b,c){var e=!1,f=c;return a.alwaysOn?d(a,b,c):{dirty:e,newValue:f,oldValue:c}},g.onBaseError=function(a,b,c){var d=!1,e=c;return c.length&&(d=!0,e=[]),{dirty:d,newValue:e,oldValue:c}},g.onResize=function(b,c,d){var e=!1,f=d;return d.length&&(e=!0,f=[],a.forEach(d,function(b){var d=a.find(c,{$id:b.$id});d&&f.push(a.cloneDeep(d))})),{dirty:e,newValue:f,oldValue:d}},g.onClickArea=function(d,e,g,h){if(!d.alwaysOn&&d.click){var i=h.target.id;if(d.single){var j=a.findIndex(g,{$id:i});if(j>-1)return f(d,e,g);if(g.length){var k=f(d,e,g),l=c(d,e,k.newValue,[i]);return l.dirty=!0,l}return c(d,e,g,[i])}return b(d,e,g,[i])}return{dirty:!1,newValue:g,oldValue:g}},g.onFocusArea=function(a,b,d,f,g){if(!a.alwaysOn&&a.focus){var h=f.target.id;return g?e(a,b,d,[h]):c(a,b,d,[h])}return{dirty:!1,newValue:d,oldValue:d}},g.onHoverArea=function(a,b,d,f,g){if(!a.alwaysOn&&a.hover){var h=f.target.id;return g?e(a,b,d,[h]):c(a,b,d,[h])}return!1},g}b.module("nb.picture").factory("nbPictureMapOverlayUtils",c),c.$inject=["_"]}(window,window.angular),function(a,b){"use strict";function c(a){return a.picturefill}b.module("nb.picture").factory("picturefill",c),c.$inject=["$window"]}(window,window.angular),angular.module("nb.picture.templates",["templates/nb-picture-map-once.html","templates/nb-picture-map-overlay-areas.html","templates/nb-picture-map.html","templates/nb-picture-once.html","templates/nb-picture.html"]),angular.module("templates/nb-picture-map-once.html",[]).run(["$templateCache",function(a){a.put("templates/nb-picture-map-once.html",'<span class="picture picture-map">\n	<map ng-if="::map.areas"\n		 ng-attr-name="{{::map.name}}">\n		<area ng-repeat="area in ::map.areas track by area.$id"\n			  ng-attr-id="{{::area.$id}}"\n			  ng-attr-shape="{{::area.shape}}"\n			  ng-attr-coords="{{area.$coords | join:\',\'}}"\n			  ng-href="{{::area.href}}"\n			  ng-attr-alt="{{::area.alt}}"\n			  ng-attr-title="{{::area.title}}"\n			  ng-click="clickArea($event);"\n			  ng-focus="focusArea($event);"\n			  ng-blur="focusArea($event, true);"\n			  ng-mouseenter="hoverArea($event);"\n			  ng-mouseleave="hoverArea($event, true);" />\n	</map>\n	<picture>\n		<!--[if IE 9]><video style="display: none;"><![endif]-->\n		<source ng-repeat="source in ::picture.sources"\n				ng-srcset="{{::source.srcset}}"\n				ng-attr-media="{{::source.media}}" />\n		<!--[if IE 9]></video><![endif]-->\n		<img ng-srcset="{{::picture.img.srcset}}"\n			 ng-attr-alt="{{::picture.img.alt}}"\n			 ng-attr-usemap="{{::picture.img.usemap}}" />\n	</picture>\n	<span class="picture-map-overlays" ng-transclude></span>\n</span>')}]),angular.module("templates/nb-picture-map-overlay-areas.html",[]).run(["$templateCache",function(a){a.put("templates/nb-picture-map-overlay-areas.html",'<span class="picture-map-overlay-areas">\n	<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"\n		 ng-attr-alt="{{alt}}"\n		 ng-attr-usemap="{{usemap}}" />\n</span>')}]),angular.module("templates/nb-picture-map.html",[]).run(["$templateCache",function(a){a.put("templates/nb-picture-map.html",'<span class="picture picture-map">\n	<map ng-if="map.areas"\n		 ng-attr-name="{{map.name}}">\n		<area ng-repeat="area in map.areas track by area.$id"\n			  ng-attr-id="{{area.$id}}"\n			  ng-attr-shape="{{area.shape}}"\n			  ng-attr-coords="{{area.$coords| join:\',\'}}"\n			  ng-href="{{area.href}}"\n			  ng-attr-alt="{{area.alt}}"\n			  ng-attr-title="{{area.title}}"\n			  ng-click="clickArea($event);"\n			  ng-focus="focusArea($event);"\n			  ng-blur="focusArea($event, true);"\n			  ng-mouseenter="hoverArea($event);"\n			  ng-mouseleave="hoverArea($event, true);" />\n	</map>\n	<picture>\n		<!--[if IE 9]><video style="display: none;"><![endif]-->\n		<source ng-repeat="source in picture.sources"\n				ng-srcset="{{source.srcset}}"\n				ng-attr-media="{{source.media}}" />\n		<!--[if IE 9]></video><![endif]-->\n		<img ng-srcset="{{picture.img.srcset}}"\n			 ng-attr-alt="{{picture.img.alt}}"\n			 ng-attr-usemap="{{picture.img.usemap}}" />\n	</picture>\n	<span class="picture-map-overlays" ng-transclude></span>\n</span>')}]),angular.module("templates/nb-picture-once.html",[]).run(["$templateCache",function(a){a.put("templates/nb-picture-once.html",'<span class="picture">\n	<picture>\n		<!--[if IE 9]><video style="display: none;"><![endif]-->\n		<source ng-repeat="source in ::picture.sources"\n				ng-srcset="{{::source.srcset}}"\n				ng-attr-media="{{::source.media}}" />\n		<!--[if IE 9]></video><![endif]-->\n		<img ng-srcset="{{::picture.img.srcset}}"\n			 ng-attr-alt="{{::picture.img.alt}}" />\n	</picture>\n</span>')}]),angular.module("templates/nb-picture.html",[]).run(["$templateCache",function(a){a.put("templates/nb-picture.html",'<span class="picture">\n	<picture>\n		<!--[if IE 9]><video style="display: none;"><![endif]-->\n		<source ng-repeat="source in picture.sources"\n				ng-srcset="{{source.srcset}}"\n				ng-attr-media="{{source.media}}" />\n		<!--[if IE 9]></video><![endif]-->\n		<img ng-srcset="{{picture.img.srcset}}"\n			 ng-attr-alt="{{picture.img.alt}}" />\n	</picture>\n</span>')}]);