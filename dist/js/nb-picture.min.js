/*
 * nb-picture
 * https://github.com/netbek/nb-picture
 *
 * @author Hein Bekker <hein@netbek.co.za>
 * @copyright (c) 2015 Hein Bekker
 * @license http://www.gnu.org/licenses/agpl-3.0.txt AGPLv3
 */
!function(a,b){"use strict";b.module("nb.picture",["nb.i18n","nb.lodash","nb.picture.templates"])}(window,window.angular),function(a,b){"use strict";b.module("nb.picture").filter("join",function(){return function(a,c){return b.isArray(a)?a.join(b.isDefined(c)?c:","):""}})}(window,window.angular),function(a,b){"use strict";function c(){var a={mediaqueries:{small:"only screen and (min-width: 0px)",medium:"only screen and (min-width: 640px)",large:"only screen and (min-width: 992px)",xlarge:"only screen and (min-width: 1440px)",xxlarge:"only screen and (min-width: 1920px)",landscape:"only screen and (orientation: landscape)",portrait:"only screen and (orientation: portrait)",retina:"only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (min--moz-device-pixel-ratio: 2), only screen and (-o-min-device-pixel-ratio: 2/1), only screen and (min-device-pixel-ratio: 2), only screen and (min-resolution: 192dpi), only screen and (min-resolution: 2dppx)"}};return{set:function(b){a=b},$get:function(){return a}}}b.module("nb.picture").provider("nbPictureConfig",c)}(window,window.angular),function(a,b){"use strict";function c(a,b,c,d,e,f,g,h){function i(a){var b=a.readyState;return!a.src&&!a.srcset||!a.complete&&"complete"!=b&&"loaded"!=b&&4!=b?!1:!0}function j(){(o.src||o.srcset)&&(a.complete=!0,m())}function k(){i(o)&&(a.complete=!0,m())}function l(){n.on("error",j),n.on("load",k),n.on("readystatechange",k)}function m(){n.off("error",j),n.off("load",k),n.off("readystatechange",k)}var n,o,p={init:!1},q=[];a.complete=!1,a.width=function(){return a.complete&&o?o.scrollWidth:0},a.height=function(){return a.complete&&o?o.scrollHeight:0},this.attrs=function(){return{defaultSource:c.defaultSource,sources:c.sources,alt:c.alt}},this.init=function(){p.init||(p.init=!0,n=b.find("img"),o=n[0])},this.destroy=function(){h.forEach(q,function(a){d.cancel(a)}),n&&m()},this.update=function(c){if(p.init){this.destroy(),a.complete=!1,l(),h.isUndefined(c.alt)&&(c.alt="");var i={sources:[],img:{}},j=a.$eval(c.sources);if(!h.isArray(j))throw new Error(e.t('Excepted attribute "!attribute" to evaluate to !type',{"!attribute":"sources","!type":"Array"}));for(var k=j.length,m=k-1;m>=0;m--){var n,o=j[m];!h.isUndefined(o[1])&&o[1]in f.mediaqueries&&(n=f.mediaqueries[o[1]]),i.sources.push({srcset:o[0],media:n})}i.sources.push({srcset:c.defaultSource}),i.img={srcset:c.defaultSource,alt:c.alt},a.picture=i,q.push(d(function(){g(b)}))}}}b.module("nb.picture").controller("nbPictureController",c),c.$inject=["$scope","$element","$attrs","$timeout","nbI18N","nbPictureConfig","picturefill","_"]}(window,window.angular),function(a,b){"use strict";function c(){return{restrict:"EA",replace:!0,controller:"nbPictureController",templateUrl:"templates/nb-picture.html",link:function(a,b,c,d){d.init();var e=a.$watch(d.attrs,function(a){d.update(a)},!0);a.$on("$destroy",function(){e(),d.destroy()})}}}b.module("nb.picture").directive("nbPicture",c)}(window,window.angular),function(a,b){"use strict";function c(){return{restrict:"EA",replace:!0,controller:"nbPictureController",templateUrl:"templates/nb-picture-once.html",link:function(a,b,c,d){d.init();var e=a.$watch(d.attrs,function(a){d.update(a),e()},!0);a.$on("$destroy",function(){e(),d.destroy()})}}}b.module("nb.picture").directive("nbPictureOnce",c)}(window,window.angular),function(a,b,c){"use strict";function d(b,d,f,g,h,i,j,k){function l(a){var b=a.readyState;return!a.src&&!a.srcset||!a.complete&&"complete"!=b&&"loaded"!=b&&4!=b?!1:!0}function m(){(v.src||v.srcset)&&(b.complete=!0,p(),b.$broadcast("nbPicture:baseError"))}function n(){l(v)&&(b.complete=!0,p(),t(b.map),b.$broadcast("nbPicture:baseLoad"),b.$apply())}function o(){u.on("error",m),u.on("load",n),u.on("readystatechange",n)}function p(){u.off("error",m),u.off("load",n),u.off("readystatechange",n)}function q(){t(b.map),b.$broadcast("nbPicture:resize"),b.$apply()}function r(){a.addEventListener?a.addEventListener("resize",q,!1):a.attachEvent&&a.attachEvent("onresize",q)}function s(){a.removeEventListener?a.removeEventListener("resize",q,!1):a.detachEvent&&a.detachEvent("onresize",q)}function t(a){if(!a.relCoords)return a;var c=b.width(),d=b.height();return c&&d?(k.forEach(a.areas,function(b,e){var f,g=b.shape.toLowerCase(),h=b.coords,i=h.length,j=new Array(i);if("circle"===g)for(f=0;i>f&&3>f;f++)j[f]=Math.round(2>f?h[f]*(f%2===0?c:d):h[f]*Math.min(c,d));else if("poly"===g)for(f=0;i>f;f++)j[f]=Math.round(h[f]*(f%2===0?c:d));else if("rect"===g)for(f=0;i>f&&4>f;f++)j[f]=Math.round(h[f]*(f%2===0?c:d));a.areas[e].$coords=j}),a):a}var u,v,w={init:!1,touch:!1},x=[],y={$show:!1,name:c,areas:[],resize:!1,relCoords:!1,overlays:{}},z={$id:c,$coords:[],shape:c,coords:[],href:c,alt:"",title:"",data:c},A={alwaysOn:!1,click:!1,focus:!1,hover:!1,single:!1};b.complete=!1,b.map=k.cloneDeep(y),b.clickArea=function(a){b.$broadcast("nbPicture:clickArea",a)},b.focusArea=function(a,c){b.$broadcast("nbPicture:focusArea",a,c)},b.hoverArea=function(a,c){b.$broadcast("nbPicture:hoverArea",a,c)},b.width=function(){return b.complete&&v?v.scrollWidth:0},b.height=function(){return b.complete&&v?v.scrollHeight:0},this.attrs=function(){return{defaultSource:f.defaultSource,sources:f.sources,alt:f.alt,map:f.map}},this.init=function(){w.init||(w.init=!0,u=d.find("img"),v=u[0])},this.destroy=function(){k.forEach(x,function(a){g.cancel(a)}),s(),u&&p()},this.update=function(a){if(w.init){this.destroy(),b.complete=!1,o(),k.isUndefined(a.alt)&&(a.alt="");var c=b.$eval(a.map);if(!k.isObject(c))throw new Error(h.t('Excepted attribute "!attribute" to evaluate to !type',{"!attribute":"map","!type":"Object"}));c=k.extend({},y,c),c.name=c.name||"nb-picture-map-"+ ++e,k.forEach(c.areas,function(a,b){c.areas[b]=k.extend({},z,a,{$id:"nb-picture-map-area-"+ ++e,$coords:a.coords})});var f={};k.forEach(c.overlays,function(a,b){a=k.extend({},A,a),w.touch&&(a.click=!0,a.focus=!1,a.hover=!1),(a.alwaysOn||a.click||a.focus||a.hover)&&(a.$id=b,f[b]=a)}),c.overlays=f;var l={sources:[],img:{}},m=b.$eval(a.sources);if(!k.isArray(m))throw new Error(h.t('Excepted attribute "!attribute" to evaluate to !type',{"!attribute":"sources","!type":"Array"}));for(var n=m.length,p=n-1;p>=0;p--){var q,s=m[p];!k.isUndefined(s[1])&&s[1]in i.mediaqueries&&(q=i.mediaqueries[s[1]]),l.sources.push({srcset:s[0],media:q})}l.sources.push({srcset:a.defaultSource}),l.img={srcset:a.defaultSource,alt:a.alt,usemap:!c.resize&&c.name?"#"+c.name:""},b.map=c,b.picture=l,x.push(g(function(){j(d),r()}))}}}b.module("nb.picture").controller("nbPictureMapController",d);var e=0;d.$inject=["$scope","$element","$attrs","$timeout","nbI18N","nbPictureConfig","picturefill","_"]}(window,window.angular),function(a,b){"use strict";function c(){return{restrict:"EA",replace:!0,transclude:!0,controller:"nbPictureMapController",templateUrl:"templates/nb-picture-map.html",link:function(a,b,c,d){d.init();var e=a.$watch(d.attrs,function(a){d.update(a)},!0);a.$on("$destroy",function(){e(),d.destroy()})}}}b.module("nb.picture").directive("nbPictureMap",c)}(window,window.angular),function(a,b){"use strict";function c(){return{restrict:"EA",replace:!0,transclude:!0,controller:"nbPictureMapController",templateUrl:"templates/nb-picture-map-once.html",link:function(a,b,c,d){d.init();var e=a.$watch(d.attrs,function(a){d.update(a),e()},!0);a.$on("$destroy",function(){e(),d.destroy()})}}}b.module("nb.picture").directive("nbPictureMapOnce",c)}(window,window.angular),function(a,b){"use strict";function c(){return{restrict:"EA",replace:!0,scope:!0,templateUrl:"templates/nb-picture-map-overlay-areas.html",link:function(a){var c=a.$watch(function(){return{alt:a.picture&a.picture.img?a.picture.img.alt:"",usemap:a.map?a.map.name:""}},function(a,c,d){b.forEach(a,function(a,b){d[b]=a})},!0);a.$on("$destroy",function(){c()})}}}b.module("nb.picture").directive("nbPictureMapOverlayAreas",c)}(window,window.angular),function(a,b){"use strict";function c(a){function b(b,c,d,e){var f=!1,g=d;return e.length&&(f=!0,g=[],a.forEach(e,function(b){var e=a.findIndex(d,{$id:b});if(0>e){var f=a.find(c,{$id:b});f&&g.push(a.cloneDeep(f))}})),{dirty:f,newValue:g,oldValue:d}}function c(b,c,d,e){var f=!1,g=d;return e.length&&(f=!0,g=[],a.forEach(e,function(b){var d=a.find(c,{$id:b});d&&g.push(a.cloneDeep(d))})),{dirty:f,newValue:g,oldValue:d}}function d(b,d,e){return c(b,d,e,a.pluck(d,"$id"))}function e(b,c,d,e){var f=!1,g=d;return e.length&&(f=!0,g=[],a.forEach(d,function(b){a.indexOf(e,b.$id)<0&&g.push(b)})),{dirty:f,newValue:g,oldValue:d}}function f(b,c,d){return e(b,c,d,a.pluck(d,"$id"))}var g={};return g.onBaseLoad=function(a,b,c){var e=!1,f=c;return a.alwaysOn?d(a,b,c):{dirty:e,newValue:f,oldValue:c}},g.onBaseError=function(a,b,c){var d=!1,e=c;return c.length&&(d=!0,e=[]),{dirty:d,newValue:e,oldValue:c}},g.onResize=function(b,c,d){var e=!1,f=d;return d.length&&(e=!0,f=[],a.forEach(d,function(b){var d=a.find(c,{$id:b.$id});d&&f.push(a.cloneDeep(d))})),{dirty:e,newValue:f,oldValue:d}},g.onClickArea=function(d,e,g,h){if(!d.alwaysOn&&d.click){var i=h.target.id;if(d.single){var j=a.findIndex(g,{$id:i});if(j>-1)return f(d,e,g);if(g.length){var k=f(d,e,g),l=c(d,e,k.newValue,[i]);return l.dirty=!0,l}return c(d,e,g,[i])}return b(d,e,g,[i])}return{dirty:!1,newValue:g,oldValue:g}},g.onFocusArea=function(a,b,d,f,g){if(!a.alwaysOn&&a.focus){var h=f.target.id;return g?e(a,b,d,[h]):c(a,b,d,[h])}return{dirty:!1,newValue:d,oldValue:d}},g.onHoverArea=function(a,b,d,f,g){if(!a.alwaysOn&&a.hover){var h=f.target.id;return g?e(a,b,d,[h]):c(a,b,d,[h])}return!1},g}b.module("nb.picture").factory("nbPictureMapOverlayUtils",c),c.$inject=["_"]}(window,window.angular),function(a,b){"use strict";function c(a){return a.picturefill}b.module("nb.picture").factory("picturefill",c),c.$inject=["$window"]}(window,window.angular),angular.module("nb.picture.templates",["templates/nb-picture-map-once.html","templates/nb-picture-map-overlay-areas.html","templates/nb-picture-map.html","templates/nb-picture-once.html","templates/nb-picture.html"]),angular.module("templates/nb-picture-map-once.html",[]).run(["$templateCache",function(a){a.put("templates/nb-picture-map-once.html",'<span class="picture picture-map">\n	<map ng-if="::map.areas"\n		 ng-attr-name="{{::map.name}}">\n		<area ng-repeat="area in ::map.areas track by area.$id"\n			  ng-attr-id="{{::area.$id}}"\n			  ng-attr-shape="{{::area.shape}}"\n			  ng-attr-coords="{{area.$coords | join:\',\'}}"\n			  ng-href="{{::area.href}}"\n			  ng-attr-alt="{{::area.alt}}"\n			  ng-attr-title="{{::area.title}}"\n			  ng-click="clickArea($event);"\n			  ng-focus="focusArea($event);"\n			  ng-blur="focusArea($event, true);"\n			  ng-mouseenter="hoverArea($event);"\n			  ng-mouseleave="hoverArea($event, true);" />\n	</map>\n	<picture>\n		<!--[if IE 9]><video style="display: none;"><![endif]-->\n		<source ng-repeat="source in ::picture.sources"\n				ng-srcset="{{::source.srcset}}"\n				ng-attr-media="{{::source.media}}" />\n		<!--[if IE 9]></video><![endif]-->\n		<img ng-srcset="{{::picture.img.srcset}}"\n			 ng-attr-alt="{{::picture.img.alt}}"\n			 ng-attr-usemap="{{::picture.img.usemap}}" />\n	</picture>\n	<span class="picture-map-overlays" ng-transclude></span>\n</span>')}]),angular.module("templates/nb-picture-map-overlay-areas.html",[]).run(["$templateCache",function(a){a.put("templates/nb-picture-map-overlay-areas.html",'<span class="picture-map-overlay-areas">\n	<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"\n		 ng-attr-alt="{{alt}}"\n		 ng-attr-usemap="{{usemap}}" />\n</span>')}]),angular.module("templates/nb-picture-map.html",[]).run(["$templateCache",function(a){a.put("templates/nb-picture-map.html",'<span class="picture picture-map">\n	<map ng-if="map.areas"\n		 ng-attr-name="{{map.name}}">\n		<area ng-repeat="area in map.areas track by area.$id"\n			  ng-attr-id="{{area.$id}}"\n			  ng-attr-shape="{{area.shape}}"\n			  ng-attr-coords="{{area.$coords| join:\',\'}}"\n			  ng-href="{{area.href}}"\n			  ng-attr-alt="{{area.alt}}"\n			  ng-attr-title="{{area.title}}"\n			  ng-click="clickArea($event);"\n			  ng-focus="focusArea($event);"\n			  ng-blur="focusArea($event, true);"\n			  ng-mouseenter="hoverArea($event);"\n			  ng-mouseleave="hoverArea($event, true);" />\n	</map>\n	<picture>\n		<!--[if IE 9]><video style="display: none;"><![endif]-->\n		<source ng-repeat="source in picture.sources"\n				ng-srcset="{{source.srcset}}"\n				ng-attr-media="{{source.media}}" />\n		<!--[if IE 9]></video><![endif]-->\n		<img ng-srcset="{{picture.img.srcset}}"\n			 ng-attr-alt="{{picture.img.alt}}"\n			 ng-attr-usemap="{{picture.img.usemap}}" />\n	</picture>\n	<span class="picture-map-overlays" ng-transclude></span>\n</span>')}]),angular.module("templates/nb-picture-once.html",[]).run(["$templateCache",function(a){a.put("templates/nb-picture-once.html",'<span class="picture">\n	<picture>\n		<!--[if IE 9]><video style="display: none;"><![endif]-->\n		<source ng-repeat="source in ::picture.sources"\n				ng-srcset="{{::source.srcset}}"\n				ng-attr-media="{{::source.media}}" />\n		<!--[if IE 9]></video><![endif]-->\n		<img ng-srcset="{{::picture.img.srcset}}"\n			 ng-attr-alt="{{::picture.img.alt}}" />\n	</picture>\n</span>')}]),angular.module("templates/nb-picture.html",[]).run(["$templateCache",function(a){a.put("templates/nb-picture.html",'<span class="picture">\n	<picture>\n		<!--[if IE 9]><video style="display: none;"><![endif]-->\n		<source ng-repeat="source in picture.sources"\n				ng-srcset="{{source.srcset}}"\n				ng-attr-media="{{source.media}}" />\n		<!--[if IE 9]></video><![endif]-->\n		<img ng-srcset="{{picture.img.srcset}}"\n			 ng-attr-alt="{{picture.img.alt}}" />\n	</picture>\n</span>')}]);