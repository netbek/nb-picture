/*
 * nb-picture
 * https://github.com/netbek/nb-picture
 *
 * @author Hein Bekker <hein@netbek.co.za>
 * @copyright (c) 2015 Hein Bekker
 * @license http://www.gnu.org/licenses/agpl-3.0.txt AGPLv3
 */
!function(a,b){"use strict";b.module("nb.picture",["nb.i18n","nb.lodash","nb.picture.templates"])}(window,window.angular),function(a,b){"use strict";b.module("nb.picture").filter("join",function(){return function(a,b){return _.isArray(a)?a.join(_.isUndefined(b)?",":b):""}})}(window,window.angular),function(a,b){"use strict";function c(){var a={mediaqueries:{small:"only screen and (min-width: 0px)",medium:"only screen and (min-width: 640px)",large:"only screen and (min-width: 992px)",xlarge:"only screen and (min-width: 1440px)",xxlarge:"only screen and (min-width: 1920px)",landscape:"only screen and (orientation: landscape)",portrait:"only screen and (orientation: portrait)",retina:"only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (min--moz-device-pixel-ratio: 2), only screen and (-o-min-device-pixel-ratio: 2/1), only screen and (min-device-pixel-ratio: 2), only screen and (min-resolution: 192dpi), only screen and (min-resolution: 2dppx)"}};return{set:function(b){a=b},$get:function(){return a}}}b.module("nb.picture").provider("nbPictureConfig",c)}(window,window.angular),function(a,b){"use strict";function c(a,b,c,d,e,f,g){function h(a){var b=a.readyState;return!a.src&&!a.srcset||!a.complete&&"complete"!=b&&"loaded"!=b&&4!=b?!1:!0}function i(){(n.src||n.srcset)&&(a.complete=!0,l())}function j(){h(n)&&(a.complete=!0,l())}function k(){m.on("error",i),m.on("load",j),m.on("readystatechange",j)}function l(){m.off("error",i),m.off("load",j),m.off("readystatechange",j)}var m,n,o={init:!1},p=[];a.complete=!1,a.width=function(){return a.complete&&n?n.scrollWidth:0},a.height=function(){return a.complete&&n?n.scrollHeight:0},this.attrs=function(){return{defaultSource:c.defaultSource,sources:c.sources,alt:c.alt}},this.init=function(){o.init||(o.init=!0,m=b.find("img"),n=m[0])},this.destroy=function(){_.forEach(p,function(a){d.cancel(a)}),m&&l()},this.update=function(c){if(o.init){this.destroy(),a.complete=!1,k(),_.isUndefined(c.alt)&&(c.alt="");var h={sources:[],img:{}},i=a.$eval(c.sources);if(!_.isArray(i))throw new Error(e.t('Excepted attribute "!attribute" to evaluate to !type',{"!attribute":"sources","!type":"Array"}));for(var j=i.length,l=j-1;l>=0;l--){var m,n=i[l];!_.isUndefined(n[1])&&n[1]in f.mediaqueries&&(m=f.mediaqueries[n[1]]),h.sources.push({srcset:n[0],media:m})}h.sources.push({srcset:c.defaultSource}),h.img={srcset:c.defaultSource,alt:c.alt},a.picture=h,p.push(d(function(){g(b)}))}}}b.module("nb.picture").controller("nbPictureController",c),c.$inject=["$scope","$element","$attrs","$timeout","nbI18N","nbPictureConfig","picturefill"]}(window,window.angular),function(a,b){"use strict";function c(){return{restrict:"EA",replace:!0,controller:"nbPictureController",templateUrl:"templates/nb-picture.html",link:function(a,b,c,d){d.init();var e=a.$watch(d.attrs,function(a){d.update(a)},!0);a.$on("$destroy",function(){e(),d.destroy()})}}}b.module("nb.picture").directive("nbPicture",c)}(window,window.angular),function(a,b){"use strict";function c(){return{restrict:"EA",replace:!0,controller:"nbPictureController",templateUrl:"templates/nb-picture-once.html",link:function(a,b,c,d){d.init();var e=a.$watch(d.attrs,function(a){d.update(a),e()},!0);a.$on("$destroy",function(){e(),d.destroy()})}}}b.module("nb.picture").directive("nbPictureOnce",c)}(window,window.angular),function(a,b,c){"use strict";function d(b,d,f,g,h,i,j){function k(a){var b=a.readyState;return!a.src&&!a.srcset||!a.complete&&"complete"!=b&&"loaded"!=b&&4!=b?!1:!0}function l(){(u.src||u.srcset)&&(b.complete=!0,o(),w.push(g(function(){b.map.$show=!1,b.$apply()})))}function m(){k(u)&&(b.complete=!0,o(),(b.map.highlight.enable||b.map.resize)&&w.push(g(function(){s(b.map),b.map.highlight.enable&&b.map.highlight.alwaysOn&&(b.highlights=_.cloneDeep(b.map.areas),b.$broadcast("nbPicture:draw")),b.map.$show=!0,b.$apply()})))}function n(){t.on("error",l),t.on("load",m),t.on("readystatechange",m)}function o(){t.off("error",l),t.off("load",m),t.off("readystatechange",m)}function p(){if(b.map.resize&&s(b.map),b.map.highlight.enable&&b.highlights.length){var a=_.pluck(b.highlights,"$id"),c=[];_.forEach(a,function(a){var d=_.find(b.map.areas,{$id:a});d&&c.push(_.cloneDeep(d))}),b.highlights=c,b.$broadcast("nbPicture:draw")}b.$apply()}function q(){a.addEventListener?a.addEventListener("resize",p,!1):a.attachEvent&&a.attachEvent("onresize",p)}function r(){a.removeEventListener?a.removeEventListener("resize",p,!1):a.detachEvent&&a.detachEvent("onresize",p)}function s(a){if(a.relCoords){var c=b.width(),d=b.height();_.forEach(a.areas,function(b,e){var f,g=b.shape.toLowerCase(),h=b.coords,i=h.length,j=new Array(i);if("circle"===g)for(f=0;i>f&&3>f;f++)2>f&&(j[f]=Math.round(h[f]*(f%2===0?c:d)));else if("poly"===g)for(f=0;i>f;f++)j[f]=Math.round(h[f]*(f%2===0?c:d));else if("rect"===g)for(f=0;i>f&&4>f;f++)j[f]=Math.round(h[f]*(f%2===0?c:d));a.areas[e].$coords=j})}return a}var t,u,v={init:!1},w=[],x={$show:!1,name:c,areas:[],resize:!1,relCoords:!1,highlight:{enable:!1,fill:!0,fillColor:"FF0000",fillOpacity:.5,alwaysOn:!1}},y={$id:c,$coords:[],shape:c,coords:[],href:c,alt:"",title:"",data:c};b.complete=!1,b.map=_.cloneDeep(x),b.highlights=[],b.showHighlight=function(a){var c=a.target,d=_.findIndex(b.highlights,{$id:c.id});if(0>d){var e=_.find(b.map.areas,{$id:c.id});e&&(b.highlights.push(_.cloneDeep(e)),b.$broadcast("nbPicture:draw"))}},b.hideHighlight=function(a){if(!b.map.highlight.alwaysOn){var c=_.findIndex(b.highlights,{$id:a.target.id});c>=0&&(b.highlights.splice(c,1),b.$broadcast("nbPicture:draw"))}},b.width=function(){return b.complete&&u?u.scrollWidth:0},b.height=function(){return b.complete&&u?u.scrollHeight:0},this.attrs=function(){return{defaultSource:f.defaultSource,sources:f.sources,alt:f.alt,map:f.map}},this.init=function(){v.init||(v.init=!0,t=d.find("img"),u=t[0])},this.destroy=function(){_.forEach(w,function(a){g.cancel(a)}),r(),t&&o(),b.highlights=[]},this.update=function(a){if(v.init){this.destroy(),b.complete=!1,n(),_.isUndefined(a.alt)&&(a.alt="");var c=b.$eval(a.map);if(!_.isObject(c))throw new Error(h.t('Excepted attribute "!attribute" to evaluate to !type',{"!attribute":"map","!type":"Object"}));c=_.extend({},x,c),c.name=c.name||"nb-picture-map-"+ ++e,_.forEach(c.areas,function(a,b){c.areas[b]=_.extend({},y,a,{$id:"nb-picture-map-area-"+ ++e,$coords:a.coords})});var f={sources:[],img:{}},k=b.$eval(a.sources);if(!_.isArray(k))throw new Error(h.t('Excepted attribute "!attribute" to evaluate to !type',{"!attribute":"sources","!type":"Array"}));for(var l=k.length,m=l-1;m>=0;m--){var o,p=k[m];!_.isUndefined(p[1])&&p[1]in i.mediaqueries&&(o=i.mediaqueries[p[1]]),f.sources.push({srcset:p[0],media:o})}f.sources.push({srcset:a.defaultSource}),f.img={srcset:a.defaultSource,alt:a.alt,usemap:!c.resize&&c.name?"#"+c.name:""},c.img={src:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",alt:a.alt,usemap:c.name?"#"+c.name:""},b.map=c,b.picture=f,w.push(g(function(){j(d),q()}))}}}b.module("nb.picture").controller("nbPictureMapController",d);var e=0;d.$inject=["$scope","$element","$attrs","$timeout","nbI18N","nbPictureConfig","picturefill"]}(window,window.angular),function(a,b){"use strict";function c(){return{restrict:"EA",replace:!0,controller:"nbPictureMapController",templateUrl:"templates/nb-picture-map.html",link:function(a,b,c,d){d.init();var e=a.$watch(d.attrs,function(a){d.update(a)},!0);a.$on("$destroy",function(){e(),d.destroy()})}}}b.module("nb.picture").directive("nbPictureMap",c)}(window,window.angular),function(a,b){"use strict";function c(){return{restrict:"EA",replace:!0,controller:"nbPictureMapController",templateUrl:"templates/nb-picture-map-once.html",link:function(a,b,c,d){d.init();var e=a.$watch(d.attrs,function(a){d.update(a),e()},!0);a.$on("$destroy",function(){e(),d.destroy()})}}}b.module("nb.picture").directive("nbPictureMapOnce",c)}(window,window.angular),function(a,b){"use strict";function c(){return{restrict:"EA",replace:!0,templateUrl:"templates/nb-picture-map-resize.html"}}b.module("nb.picture").directive("nbPictureMapResize",c)}(window,window.angular),function(a,b){"use strict";function c(a,b){function c(){i.init&&(k.areas=[],h.clearRect(0,0,g.width,g.height))}function d(b){if(i.init&&(k.areas=b,g.width=g.scrollWidth,g.height=g.scrollHeight,b.length)){var c=a.map.highlight;c.fill&&(h.fillStyle=f(c.fillColor,c.fillOpacity)),_.forEach(b,function(a){var b=a.shape,c=a.$coords;if("circle"===b);else if("poly"===b);else if("rect"===b){var d=c[0],e=c[1],f=c[2]-c[0],g=c[3]-c[1];h.fillRect(d,e,f,g)}})}}function e(a){return Math.max(0,Math.min(parseInt(a,16),255))}function f(a,b){return"rgba("+e(a.slice(0,2))+","+e(a.slice(2,4))+","+e(a.slice(4,6))+","+b+")"}var g,h,i={init:!1,resize:!1},j=[],k={areas:[]};this.init=function(){i.init||(i.init=!0,g=b[0],h=g.getContext("2d"),d(a.highlights),j.push(a.$on("nbPicture:draw",function(){a.highlights.length?d(a.highlights):c()})))},this.destroy=function(){_.forEach(j,function(a){a()})}}b.module("nb.picture").controller("nbPictureMapResizeCanvasController",c),c.$inject=["$scope","$element","$attrs","$timeout"]}(window,window.angular),function(a,b){"use strict";function c(){return{restrict:"EA",replace:!0,controller:"nbPictureMapResizeCanvasController",templateUrl:"templates/nb-picture-map-resize-canvas.html",link:function(a,b,c,d){d.init(),a.$on("$destroy",function(){d.destroy()})}}}b.module("nb.picture").directive("nbPictureMapResizeCanvas",c)}(window,window.angular),function(a,b){"use strict";function c(a){return a.picturefill}b.module("nb.picture").factory("picturefill",c),c.$inject=["$window"]}(window,window.angular),angular.module("nb.picture.templates",["templates/nb-picture-map-once.html","templates/nb-picture-map-resize-canvas.html","templates/nb-picture-map-resize.html","templates/nb-picture-map.html","templates/nb-picture-once.html","templates/nb-picture.html"]),angular.module("templates/nb-picture-map-once.html",[]).run(["$templateCache",function(a){a.put("templates/nb-picture-map-once.html",'<span class="picture picture-map">\n	<map ng-if="::map.areas"\n		 ng-attr-name="{{::map.name}}">\n		<area ng-repeat="area in ::map.areas track by area.$id"\n			  ng-attr-id="{{::area.$id}}"\n			  ng-attr-shape="{{::area.shape}}"\n			  ng-attr-coords="{{area.$coords | join:\',\'}}"\n			  ng-href="{{::area.href}}"\n			  ng-attr-alt="{{::area.alt}}"\n			  ng-attr-title="{{::area.title}}"\n			  ng-focus="showHighlight($event);"\n			  ng-mouseenter="showHighlight($event);"\n			  ng-blur="hideHighlight($event);"\n			  ng-mouseleave="hideHighlight($event);" />\n	</map>\n	<picture>\n		<!--[if IE 9]><video style="display: none;"><![endif]-->\n		<source ng-repeat="source in ::picture.sources"\n				ng-srcset="{{::source.srcset}}"\n				ng-attr-media="{{::source.media}}" />\n		<!--[if IE 9]></video><![endif]-->\n		<img ng-srcset="{{::picture.img.srcset}}"\n			 ng-attr-alt="{{::picture.img.alt}}"\n			 ng-attr-usemap="{{::picture.img.usemap}}" />\n	</picture>\n	<span nb-picture-map-resize\n		  ng-if="map.$show && (map.highlight.enable || map.resize)"></span>\n</span>')}]),angular.module("templates/nb-picture-map-resize-canvas.html",[]).run(["$templateCache",function(a){a.put("templates/nb-picture-map-resize-canvas.html","<canvas></canvas>\n")}]),angular.module("templates/nb-picture-map-resize.html",[]).run(["$templateCache",function(a){a.put("templates/nb-picture-map-resize.html",'<span class="picture-map-resize">\n	<span nb-picture-map-resize-canvas></span>\n	<img ng-src="{{map.img.src}}"\n		 ng-attr-alt="{{map.img.alt}}"\n		 ng-attr-usemap="{{map.img.usemap}}" />\n</span>')}]),angular.module("templates/nb-picture-map.html",[]).run(["$templateCache",function(a){a.put("templates/nb-picture-map.html",'<span class="picture picture-map">\n	<map ng-if="map.areas"\n		 ng-attr-name="{{map.name}}">\n		<area ng-repeat="area in map.areas track by area.$id"\n			  ng-attr-id="{{area.$id}}"\n			  ng-attr-shape="{{area.shape}}"\n			  ng-attr-coords="{{area.$coords | join:\',\'}}"\n			  ng-href="{{area.href}}"\n			  ng-attr-alt="{{area.alt}}"\n			  ng-attr-title="{{area.title}}"\n			  ng-focus="showHighlight($event);"\n			  ng-mouseenter="showHighlight($event);"\n			  ng-blur="hideHighlight($event);"\n			  ng-mouseleave="hideHighlight($event);" />\n	</map>\n	<picture>\n		<!--[if IE 9]><video style="display: none;"><![endif]-->\n		<source ng-repeat="source in picture.sources"\n				ng-srcset="{{source.srcset}}"\n				ng-attr-media="{{source.media}}" />\n		<!--[if IE 9]></video><![endif]-->\n		<img ng-srcset="{{picture.img.srcset}}"\n			 ng-attr-alt="{{picture.img.alt}}"\n			 ng-attr-usemap="{{picture.img.usemap}}" />\n	</picture>\n	<span nb-picture-map-resize\n		  ng-if="map.$show && (map.highlight.enable || map.resize)"></span>\n</span>')}]),angular.module("templates/nb-picture-once.html",[]).run(["$templateCache",function(a){a.put("templates/nb-picture-once.html",'<span class="picture">\n	<picture>\n		<!--[if IE 9]><video style="display: none;"><![endif]-->\n		<source ng-repeat="source in ::picture.sources"\n				ng-srcset="{{::source.srcset}}"\n				ng-attr-media="{{::source.media}}" />\n		<!--[if IE 9]></video><![endif]-->\n		<img ng-srcset="{{::picture.img.srcset}}"\n			 ng-attr-alt="{{::picture.img.alt}}" />\n	</picture>\n</span>')}]),angular.module("templates/nb-picture.html",[]).run(["$templateCache",function(a){a.put("templates/nb-picture.html",'<span class="picture">\n	<picture>\n		<!--[if IE 9]><video style="display: none;"><![endif]-->\n		<source ng-repeat="source in picture.sources"\n				ng-srcset="{{source.srcset}}"\n				ng-attr-media="{{source.media}}" />\n		<!--[if IE 9]></video><![endif]-->\n		<img ng-srcset="{{picture.img.srcset}}"\n			 ng-attr-alt="{{picture.img.alt}}" />\n	</picture>\n</span>')}]);