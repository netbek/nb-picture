/*
 * nb-picture
 * https://github.com/netbek/nb-picture
 *
 * @author Hein Bekker <hein@netbek.co.za>
 * @copyright (c) 2015 Hein Bekker
 * @license http://www.gnu.org/licenses/agpl-3.0.txt AGPLv3
 */
!function(a,b){"use strict";b.module("nb.picture",["nb.i18n","nb.lodash","nb.picture.templates"]).constant("PICTURE_POSITION",{LEFT_TOP:"left top",LEFT_BOTTOM:"left bottom",RIGHT_TOP:"right top",RIGHT_BOTTOM:"right bottom"}).constant("PICTURE_SHAPE",{CIRCLE:"circle",POLYGON:"poly",RECTANGLE:"rect"})}(window,window.angular),function(a,b){"use strict";b.module("nb.picture").filter("join",function(){return function(a,c){return b.isArray(a)?a.join(b.isDefined(c)?c:","):""}})}(window,window.angular),function(a,b){"use strict";function c(){var a={mediaqueries:{small:"only screen and (min-width: 0px)",medium:"only screen and (min-width: 640px)",large:"only screen and (min-width: 992px)",xlarge:"only screen and (min-width: 1440px)",xxlarge:"only screen and (min-width: 1920px)",landscape:"only screen and (orientation: landscape)",portrait:"only screen and (orientation: portrait)",retina:"only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (min--moz-device-pixel-ratio: 2), only screen and (-o-min-device-pixel-ratio: 2/1), only screen and (min-device-pixel-ratio: 2), only screen and (min-resolution: 192dpi), only screen and (min-resolution: 2dppx)"}};return{set:function(b){_.merge(a,b)},$get:function(){return a}}}b.module("nb.picture").provider("nbPictureConfig",c)}(window,window.angular),function(a,b,c){"use strict";function d(a,b,d,f,g,h){function i(a){return d.extend({},r,a,{$$id:"nb-picture-map-area-"+ ++e,$$coords:a.$$coords||a.coords})}function j(a,b,c,e){var f=!1,g=c;return e.length&&(f=!0,g=[],d.forEach(e,function(a){var e=d.findIndex(c,{$$id:a});if(0>e){var f=d.find(b,{$$id:a});f&&g.push(d.cloneDeep(f))}})),{dirty:f,newValue:g,oldValue:c}}function k(a,b,c,e){var f=!1,g=c;return e.length&&(f=!0,g=[],d.forEach(e,function(a){var c=d.find(b,{$$id:a});c&&g.push(d.cloneDeep(c))})),{dirty:f,newValue:g,oldValue:c}}function l(a,b,c){return k(a,b,c,d.pluck(b,"$$id"))}function m(a,b,c,e){var f=!1,g=c;return e.length&&(f=!0,g=[],d.forEach(c,function(a){d.indexOf(e,a.$$id)<0&&g.push(a)})),{dirty:f,newValue:g,oldValue:c}}function n(a,b,c){return m(a,b,c,d.pluck(c,"$$id"))}var o=this,p={},q={name:c,areas:[],resize:!1,relCoords:!1,overlays:{}},r={$$id:c,$$coords:[],shape:c,coords:[],href:"#",alt:"",title:"",data:c},s={$$areas:[],show:!0,alwaysOn:!1,click:!1,focus:!1,hover:!1,single:!1},t={};this.initPicture=function(){var a="nb-picture-"+ ++e;return t[a]={$$id:a,$$complete:!1},a},this.destroyPicture=function(a){t=d.omit(t,a)},this.getPicture=function(a){return t[a]},this.setPicture=function(a,b){if(!d.isArray(b.sources))throw new Error(f.t('Excepted attribute "!attribute" to evaluate to !type',{"!attribute":"sources","!type":"Array"}));d.isUndefined(b.alt)&&(b.alt="");for(var c=[],e=b.sources.length,h=e-1;h>=0;h--){var i,j=b.sources[h];!d.isUndefined(j[1])&&j[1]in g.mediaqueries&&(i=g.mediaqueries[j[1]]),c.push({srcset:j[0],media:i})}c.push({srcset:b.defaultSource});var k=o.getMap(a);t[a].sources=c,t[a].img={srcset:b.defaultSource,alt:b.alt,usemap:k&&!k.resize&&k.name?"#"+k.name:""}},this.getPictureComplete=function(a){var b=t[a];return b?b.$$complete:void 0},this.setPictureComplete=function(a,b){var c=t[a];c&&(c.$$complete=b)},this.getMap=function(a){var b=t[a];return b?b.map:void 0},this.setMap=function(a,b){if(!d.isObject(b.map))throw new Error(f.t('Excepted attribute "!attribute" to evaluate to !type',{"!attribute":"map","!type":"Object"}));var c=o.getPicture(a);if(c){var g=d.extend({},q,b.map);g.name=g.name||"nb-picture-map-"+ ++e,d.forEach(g.areas,function(a,b){g.areas[b]=i(a)});var h={};d.forEach(g.overlays,function(a,b){a=d.extend({},s,a),p.touch&&(a.click=!0,a.focus=!1,a.hover=!1),(a.alwaysOn||a.click||a.focus||a.hover)&&(a.$$id=b,h[b]=a)}),g.overlays=h,c.map=g}},this.resizeMap=function(a,b,c,e){var f=o.getMap(a);f&&b&&c&&d.forEach(f.areas,function(g,i){var j;j=f.relCoords?h.relToAbsCoords(g.shape,g.coords,b,c,e):d.cloneDeep(g.coords),f.areas[i].$$coords=j,d.forEach(f.overlays,function(b,c){var e=d.find(b.$$areas,{$$id:g.$$id});e&&(e.$$coords=j,o.setMapOverlayArea(a,c,e))})})},this.getMapAreas=function(a){var b=o.getMap(a);return b?b.areas:void 0},this.getMapArea=function(a,b){var c=o.getMap(a);return c?d.find(c.areas,{$$id:b}):void 0},this.setMapArea=function(a,b){var c=!1,e=o.getMap(a);if(e){if(!b.$$id){var f=i(b);return e.areas.push(f),d.forEach(e.overlays,function(b,c){b.alwaysOn&&o.setMapOverlayArea(a,c,f)}),f}var g=d.findIndex(e.areas,{$$id:b.$$id});g>-1&&(c=!0,e.areas[g]=b,d.forEach(e.overlays,function(c,e){var f=d.findIndex(c.$$areas,{$$id:b.$$id});f>-1&&o.setMapOverlayArea(a,e,d.cloneDeep(b))}))}return c},this.deleteMapArea=function(a,b){var c=!1,e=o.getMap(a);if(e){var f=d.findIndex(e.areas,{$$id:b});f>-1&&(c=!0,e.areas.splice(f,1)),d.forEach(e.overlays,function(a,f){var g=e.overlays[f].$$areas,h=d.findIndex(g,{$$id:b});h>-1&&(c=!0,g.splice(h,1))})}return c},this.getMapOverlay=function(a,b){var c=o.getMap(a);return c?c.overlays[b]:void 0},this.getMapOverlayAreas=function(a,b){var c=o.getMapOverlay(a,b);return c?c.$$areas:void 0},this.setMapOverlayAreas=function(a,b,c){var d=!1,e=o.getMapOverlay(a,b);return e&&(d=!0,e.$$areas=c&&c.length?c:[]),d},this.getMapOverlayArea=function(a,b,c){var e=o.getMapOverlay(a,b);return e?d.find(e.$$areas,{$$id:c}):void 0},this.setMapOverlayArea=function(a,b,c){var e=!1,f=o.getMapOverlay(a,b);if(f&&c.$$id){e=!0;var g=f.$$areas,h=d.findIndex(g,{$$id:c.$$id});h>-1?g[h]=c:g.push(c)}return e},this.showMapOverlay=function(a,b){var c=!1,d=o.getMapOverlay(a,b);return d&&!d.show&&(c=!0,d.show=!0),c},this.hideMapOverlay=function(a,b){var c=!1,d=o.getMapOverlay(a,b);return d&&d.show&&(c=!0,d.show=!1),c},this.onBaseLoad=function(a,b){var c=!1,d=o.getMapOverlay(a,b);if(d){var e=o.getMapAreas(a),f=o.getMapOverlayAreas(a,b);if(d.alwaysOn){var g=l(d,e,f);return g.dirty&&o.setMapOverlayAreas(a,b,g.newValue),g.dirty}}return c},this.onBaseError=function(a,b){var c=!1,d=o.getMapOverlay(a,b);if(d){var e=o.getMapOverlayAreas(a,b);e.length&&(c=!0,o.setMapOverlayAreas(a,b,[]))}return c},this.onClickArea=function(a,b,c){var e=!1,f=o.getMapOverlay(a,b);if(f&&!f.alwaysOn&&f.click){var g,h,i,l=c.target.id,m=o.getMapAreas(a),p=o.getMapOverlayAreas(a,b);return f.single?(h=d.findIndex(p,{$$id:l}),h>-1?(g=n(f,m,p),g.dirty&&o.setMapOverlayAreas(a,b,g.newValue),g.dirty):p.length?(i=n(f,m,p),g=k(f,m,i.newValue,[l]),g.dirty=!0,g.dirty&&o.setMapOverlayAreas(a,b,g.newValue),g.dirty):(g=k(f,m,p,[l]),g.dirty&&o.setMapOverlayAreas(a,b,g.newValue),g.dirty)):(g=j(f,m,p,[l]),g.dirty&&o.setMapOverlayAreas(a,b,g.newValue),g.dirty)}return e},this.onFocusArea=function(a,b,c,d){var e=!1,f=o.getMapOverlay(a,b);if(f&&!f.alwaysOn&&f.focus){var g,h=c.target.id,i=o.getMapAreas(a),j=o.getMapOverlayAreas(a,b);return g=d?m(f,i,j,[h]):k(f,i,j,[h]),g.dirty&&o.setMapOverlayAreas(a,b,g.newValue),g.dirty}return e},this.onHoverArea=function(a,b,c,d){var e=!1,f=o.getMapOverlay(a,b);if(f&&!f.alwaysOn&&f.hover){var g,h=c.target.id,i=o.getMapAreas(a),j=o.getMapOverlayAreas(a,b);return g=d?m(f,i,j,[h]):k(f,i,j,[h]),g.dirty&&o.setMapOverlayAreas(a,b,g.newValue),g.dirty}return e}}b.module("nb.picture").service("nbPictureService",d);var e=0;d.$inject=["PICTURE_POSITION","PICTURE_SHAPE","_","nbI18N","nbPictureConfig","nbPictureUtilService"]}(window,window.angular),function(a,b){"use strict";function c(a,b,c){this.getPosition=function(b,c){return.5>b?.5>c?a.LEFT_TOP:a.LEFT_BOTTOM:.5>c?a.RIGHT_TOP:a.RIGHT_BOTTOM},this.contains=function(a,c,d){var e=d[0],f=d[1];if(a===b.CIRCLE){var g=c[0],h=c[1],i=c[2],j=(e-g)*(e-g)+(f-h)*(f-h);return i*i>=j}if(a===b.POLYGON||a===b.RECTANGLE){var k=this.getBounds(a,c);return e>=k[0]&&e<=k[2]&&f>=k[1]&&f<=k[3]}return!1},this.getSize=function(a,b){var c=this.getBounds(a,b);return{width:c[2]-c[0],height:c[3]-c[1]}},this.getBounds=function(a,d){var e=0,f=0,g=0,h=0;if(a===b.CIRCLE)e=d[0]-d[2],f=d[1]-d[2],g=d[0]+d[2],h=d[1]+d[2];else if(a===b.POLYGON||a===b.RECTANGLE){var i=[],j=[];c.forEach(d,function(a,b){b%2===0?i.push(a):j.push(a)}),e=c.min(i),f=c.min(j),g=c.max(i),h=c.max(j)}return[e,f,g,h]},this.getCenter=function(a,c,d){var e=0,f=0;if(a===b.CIRCLE)e=c[0],f=c[1];else if(a===b.POLYGON||a===b.RECTANGLE){var g=this.getBounds(a,c);e=(g[0]+g[2])/2,f=(g[1]+g[3])/2}return d&&(e=Math.round(e),f=Math.round(f)),[e,f]},this.relToAbsCoords=function(a,c,d,e,f){var g,h,i=c.length,j=new Array(i);if(a===b.CIRCLE)for(g=0;i>g&&3>g;g++)2>g?(h=c[g]*(g%2===0?d:e),f&&(h=Math.round(h)),j[g]=h):(h=c[g]*Math.min(d,e),f&&(h=Math.round(h)),j[g]=h);else if(a===b.POLYGON)for(g=0;i>g;g++)h=c[g]*(g%2===0?d:e),f&&(h=Math.round(h)),j[g]=h;else if(a===b.RECTANGLE)for(g=0;i>g&&4>g;g++)h=c[g]*(g%2===0?d:e),f&&(h=Math.round(h)),j[g]=h;return j}}b.module("nb.picture").service("nbPictureUtilService",c),c.$inject=["PICTURE_POSITION","PICTURE_SHAPE","_"]}(window,window.angular),function(a,b){"use strict";function c(a,b,c,d,e,f,g,h,i){function j(a){var b=a.readyState;return!a.src&&!a.srcset||!a.complete&&"complete"!=b&&"loaded"!=b&&4!=b?!1:!0}function k(){(q.src||q.srcset)&&(t=!0,i.setPictureComplete(o,t),n())}function l(){j(q)&&(t=!0,i.setPictureComplete(o,t),n())}function m(){p.on("error",k),p.on("load",l),p.on("readystatechange",l)}function n(){p.off("error",k),p.off("load",l),p.off("readystatechange",l)}var o,p,q,r={init:!1},s=[],t=!1;a.width=function(){return t&&q?q.scrollWidth:0},a.height=function(){return t&&q?q.scrollHeight:0},this.attrs=function(){return{defaultSource:c.defaultSource,sources:c.sources,alt:c.alt}},this.init=function(){r.init||(r.init=!0,o=i.initPicture(),p=b.find("img"),q=p[0])},this.destroy=function(){h.forEach(s,function(a){d.cancel(a)}),p&&n(),i.destroyPicture(o)},this.update=function(c){r.init&&(h.forEach(s,function(a){d.cancel(a)}),p&&n(),t=!1,i.setPictureComplete(o,t),m(),c.sources=a.$eval(c.sources),i.setPicture(o,c),a.picture=i.getPicture(o),s.push(d(function(){g(b)})))}}b.module("nb.picture").controller("nbPictureController",c),c.$inject=["$scope","$element","$attrs","$timeout","nbI18N","nbPictureConfig","picturefill","_","nbPictureService"]}(window,window.angular),function(a,b){"use strict";function c(){return{restrict:"EA",replace:!0,scope:!0,controller:"nbPictureController",templateUrl:"templates/nb-picture.html",link:function(a,b,c,d){d.init();var e=a.$watch(d.attrs,function(a){d.update(a)},!0);a.$on("$destroy",function(){e(),d.destroy()})}}}b.module("nb.picture").directive("nbPicture",c)}(window,window.angular),function(a,b){"use strict";function c(){return{restrict:"EA",replace:!0,scope:!0,controller:"nbPictureController",templateUrl:"templates/nb-picture-once.html",link:function(a,b,c,d){d.init();var e=a.$watch(d.attrs,function(a){d.update(a),e()},!0);a.$on("$destroy",function(){e(),d.destroy()})}}}b.module("nb.picture").directive("nbPictureOnce",c)}(window,window.angular),function(a,b){"use strict";function c(b,c,d,e,f,g,h,i,j){function k(a){var b=a.readyState;return!a.src&&!a.srcset||!a.complete&&"complete"!=b&&"loaded"!=b&&4!=b?!1:!0}function l(){(u.src||u.srcset)&&(y=!0,j.setPictureComplete(s,y),o(),b.$broadcast("nbPicture:baseError"))}function m(){k(u)&&(y=!0,j.setPictureComplete(s,y),o(),j.resizeMap(s,b.width(),b.height(),!0),b.$broadcast("nbPicture:baseLoad"),b.$apply())}function n(){t.on("error",l),t.on("load",m),t.on("readystatechange",m)}function o(){t.off("error",l),t.off("load",m),t.off("readystatechange",m)}function p(){j.resizeMap(s,b.width(),b.height(),!0),b.$broadcast("nbPicture:resize"),b.$apply()}function q(){a.addEventListener?a.addEventListener("resize",p,!1):a.attachEvent&&a.attachEvent("onresize",p)}function r(){a.removeEventListener?a.removeEventListener("resize",p,!1):a.detachEvent&&a.detachEvent("onresize",p)}var s,t,u,v={init:!1,touch:!1},w=[],x=[],y=!1;b.clickArea=function(c){var d=a.location.href,e=c.target.href;0===e.indexOf(d)&&(e=e.slice(d.length)),"#"===e&&c.preventDefault(),b.$broadcast("nbPicture:clickArea",c)},b.focusArea=function(a,c){b.$broadcast("nbPicture:focusArea",a,c)},b.hoverArea=function(a,c){b.$broadcast("nbPicture:hoverArea",a,c)},b.width=function(){return y&&u?u.scrollWidth:0},b.height=function(){return y&&u?u.scrollHeight:0},this.attrs=function(){return{defaultSource:d.defaultSource,sources:d.sources,alt:d.alt,map:d.map}},this.init=function(){v.init||(v.init=!0,s=j.initPicture(),t=c.find("img"),u=t[0],x.push(b.$on("nbPicture:mapAreasChanged",function(){b.$broadcast("nbPicture:render")})))},this.destroy=function(){i.forEach(w,function(a){e.cancel(a)}),i.forEach(x,function(a){a()}),r(),t&&o(),j.destroyPicture(s)},this.update=function(a){v.init&&(i.forEach(w,function(a){e.cancel(a)}),r(),t&&o(),y=!1,j.setPictureComplete(s,y),n(),a.map=b.$eval(a.map),j.setMap(s,a),a.sources=b.$eval(a.sources),j.setPicture(s,a),b.map=j.getMap(s),b.picture=j.getPicture(s),w.push(e(function(){h(c),q()})))}}b.module("nb.picture").controller("nbPictureMapController",c),c.$inject=["$scope","$element","$attrs","$timeout","nbI18N","nbPictureConfig","picturefill","_","nbPictureService","PICTURE_SHAPE"]}(window,window.angular),function(a,b){"use strict";function c(){return{restrict:"EA",replace:!0,transclude:!0,scope:!0,controller:"nbPictureMapController",templateUrl:"templates/nb-picture-map.html",link:function(a,b,c,d){d.init();var e=a.$watch(d.attrs,function(a){d.update(a)},!0);a.$on("$destroy",function(){e(),d.destroy()})}}}b.module("nb.picture").directive("nbPictureMap",c)}(window,window.angular),function(a,b){"use strict";function c(){return{restrict:"EA",replace:!0,transclude:!0,scope:!0,controller:"nbPictureMapController",templateUrl:"templates/nb-picture-map-once.html",link:function(a,b,c,d){d.init();var e=a.$watch(d.attrs,function(a){d.update(a),e()},!0);a.$on("$destroy",function(){e(),d.destroy()})}}}b.module("nb.picture").directive("nbPictureMapOnce",c)}(window,window.angular),function(a,b){"use strict";function c(a){return{restrict:"EA",replace:!0,scope:!0,templateUrl:"templates/nb-picture-map-overlay-areas.html",link:function(b){var c=b.$watch("$parent.$parent.picture.$$id",function(c){var d={alt:"",usemap:""};if(c){var e=a.getPicture(c),f=a.getMap(c);e&&(d.alt=e.img.alt||""),f&&f.name&&(d.usemap="#"+f.name)}b.model=d});b.$on("$destroy",function(){c()})}}}b.module("nb.picture").directive("nbPictureMapOverlayAreas",c),c.$inject=["nbPictureService"]}(window,window.angular),function(a,b){"use strict";function c(a){return a.picturefill}b.module("nb.picture").factory("picturefill",c),c.$inject=["$window"]}(window,window.angular),angular.module("nb.picture.templates",["templates/nb-picture-map-once.html","templates/nb-picture-map-overlay-areas.html","templates/nb-picture-map.html","templates/nb-picture-once.html","templates/nb-picture.html"]),angular.module("templates/nb-picture-map-once.html",[]).run(["$templateCache",function(a){a.put("templates/nb-picture-map-once.html",'<span class="picture picture-map">\n	<map ng-if="::map.areas"\n		 ng-attr-name="{{::map.name}}">\n		<area ng-repeat="area in ::map.areas track by area.$$id"\n			  ng-attr-id="{{::area.$$id}}"\n			  ng-attr-shape="{{::area.shape}}"\n			  ng-attr-coords="{{area.$$coords | join:\',\'}}"\n			  ng-href="{{::area.href}}"\n			  ng-attr-alt="{{::area.alt}}"\n			  ng-attr-title="{{::area.title}}"\n			  ng-click="clickArea($event);"\n			  ng-focus="focusArea($event);"\n			  ng-blur="focusArea($event, true);"\n			  ng-mouseenter="hoverArea($event);"\n			  ng-mouseleave="hoverArea($event, true);" />\n	</map>\n	<picture>\n		<!--[if IE 9]><video style="display: none;"><![endif]-->\n		<source ng-repeat="source in ::picture.sources"\n				ng-srcset="{{::source.srcset}}"\n				ng-attr-media="{{::source.media}}" />\n		<!--[if IE 9]></video><![endif]-->\n		<img ng-srcset="{{::picture.img.srcset}}"\n			 ng-attr-alt="{{::picture.img.alt}}"\n			 ng-attr-usemap="{{::picture.img.usemap}}" />\n	</picture>\n	<span class="picture-map-overlays" ng-transclude></span>\n</span>')}]),angular.module("templates/nb-picture-map-overlay-areas.html",[]).run(["$templateCache",function(a){a.put("templates/nb-picture-map-overlay-areas.html",'<span class="picture-map-overlay-areas">\n	<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"\n		 ng-attr-alt="{{model.alt}}"\n		 ng-attr-usemap="{{model.usemap}}" />\n</span>')}]),angular.module("templates/nb-picture-map.html",[]).run(["$templateCache",function(a){a.put("templates/nb-picture-map.html",'<span class="picture picture-map">\n	<map ng-if="map.areas"\n		 ng-attr-name="{{map.name}}">\n		<area ng-repeat="area in map.areas track by area.$$id"\n			  ng-attr-id="{{area.$$id}}"\n			  ng-attr-shape="{{area.shape}}"\n			  ng-attr-coords="{{area.$$coords| join:\',\'}}"\n			  ng-href="{{area.href}}"\n			  ng-attr-alt="{{area.alt}}"\n			  ng-attr-title="{{area.title}}"\n			  ng-click="clickArea($event);"\n			  ng-focus="focusArea($event);"\n			  ng-blur="focusArea($event, true);"\n			  ng-mouseenter="hoverArea($event);"\n			  ng-mouseleave="hoverArea($event, true);" />\n	</map>\n	<picture>\n		<!--[if IE 9]><video style="display: none;"><![endif]-->\n		<source ng-repeat="source in picture.sources"\n				ng-srcset="{{source.srcset}}"\n				ng-attr-media="{{source.media}}" />\n		<!--[if IE 9]></video><![endif]-->\n		<img ng-srcset="{{picture.img.srcset}}"\n			 ng-attr-alt="{{picture.img.alt}}"\n			 ng-attr-usemap="{{picture.img.usemap}}" />\n	</picture>\n	<span class="picture-map-overlays" ng-transclude></span>\n</span>')}]),angular.module("templates/nb-picture-once.html",[]).run(["$templateCache",function(a){a.put("templates/nb-picture-once.html",'<span class="picture">\n	<picture>\n		<!--[if IE 9]><video style="display: none;"><![endif]-->\n		<source ng-repeat="source in ::picture.sources"\n				ng-srcset="{{::source.srcset}}"\n				ng-attr-media="{{::source.media}}" />\n		<!--[if IE 9]></video><![endif]-->\n		<img ng-srcset="{{::picture.img.srcset}}"\n			 ng-attr-alt="{{::picture.img.alt}}" />\n	</picture>\n</span>')}]),angular.module("templates/nb-picture.html",[]).run(["$templateCache",function(a){a.put("templates/nb-picture.html",'<span class="picture">\n	<picture>\n		<!--[if IE 9]><video style="display: none;"><![endif]-->\n		<source ng-repeat="source in picture.sources"\n				ng-srcset="{{source.srcset}}"\n				ng-attr-media="{{source.media}}" />\n		<!--[if IE 9]></video><![endif]-->\n		<img ng-srcset="{{picture.img.srcset}}"\n			 ng-attr-alt="{{picture.img.alt}}" />\n	</picture>\n</span>')}]);