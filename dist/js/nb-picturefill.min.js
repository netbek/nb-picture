/*
 * nb-picturefill
 * 
 * @author Hein Bekker <hein@netbek.co.za>
 * @copyright (c) 2015 Hein Bekker
 * @license http://www.gnu.org/licenses/agpl-3.0.txt AGPLv3
 */
!function(a,b){"use strict";function c(){}function d(a){var b=a.picturefill;return delete a.picturefill,b}function e(){var b={mediaqueries:{small:"only screen and (min-width: 0px)",medium:"only screen and (min-width: 640px)",large:"only screen and (min-width: 992px)",xlarge:"only screen and (min-width: 1440px)",xxlarge:"only screen and (min-width: 1920px)",landscape:"only screen and (orientation: landscape)",portrait:"only screen and (orientation: portrait)",retina:"only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (min--moz-device-pixel-ratio: 2), only screen and (-o-min-device-pixel-ratio: 2/1), only screen and (min-device-pixel-ratio: 2), only screen and (min-resolution: 192dpi), only screen and (min-resolution: 2dppx)"}};return{set:function(c){b=a.merge(!0,b,c)},$get:function(){return b}}}function f(a,c,d,e){return{restrict:"A",replace:!0,template:'<picture>\n				<!--[if IE 9]><video style="display: none;"><![endif]-->\n				<source ng-repeat="source in sources" bindonce="source" bo-attr bo-attr-srcset="source.srcset" bo-attr-media="source.media" />\n				<!--[if IE 9]></video><![endif]-->\n				<img bindonce="img" bo-attr bo-attr-srcset="img.srcset" bo-attr-alt="img.alt" />\n			</picture>',link:function(f,g,h){function i(){if(!o&&l&&m){o=!0;var h=f.$eval(m),i=[];if(!b.isArray(h))throw new Error(c.t('Excepted attribute "!attribute" to evaluate to !type',{"!attribute":"sources","!type":"Array"}));for(var j=h.length,k=j-1;k>=0;k--){var r,s=h[k];b.isDefined(s[1])&&s[1]in d.mediaqueries&&(r=d.mediaqueries[s[1]]),i.push({srcset:s[0],media:r})}i.push({srcset:l}),f.sources=i,f.img={srcset:l,alt:n},q.push(a(function(){e(g),p=!0}))}}function j(){p&&(s.src||s.srcset)&&(f.complete=!0)}function k(){var a=s.readyState;p&&(s.src||s.srcset)&&(s.complete||"complete"==a||"loaded"==a||4==a)&&(f.complete=!0)}var l,m,n,o=!1,p=!1,q=[],r=g.find("img"),s=r[0];f.complete=!1,r.on("error",j),r.on("load",k),r.on("readystatechange",k),f.width=function(){return p?s.scrollWidth:0},f.height=function(){return p?s.scrollHeight:0},f.$on("$destroy",function(){b.forEach(q,function(b){a.cancel(b)}),r.off("error",j),r.off("load",k),r.off("readystatechange",k)}),h.$observe("alt",function(a){a&&(n=a,i())}),h.$observe("default",function(a){a&&(l=a,i())}),h.$observe("sources",function(a){a&&(m=a,i())})}}}b.module("nb.picturefill",["nb.i18n","pasvaz.bindonce"]).factory("Picturefill",d).provider("nbPicturefillConfig",e).directive("nbPicturefill",f).run(c),c.$inject=["Picturefill"],d.$inject=["$window"],f.$inject=["$timeout","nbI18N","nbPicturefillConfig","Picturefill"]}(window,window.angular);